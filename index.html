<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WebDSO - Á∫ØÂéüÁîüÁΩëÈ°µÁ§∫Ê≥¢Âô®</title>
    <link rel="stylesheet" href="./styles/layout.css">
    <link rel="stylesheet" href="./styles/osd.css">
    <link rel="stylesheet" href="./styles/controls.css">
</head>
<body>
    <div id="sys-modal" class="sys-modal-overlay">
        <div class="sys-modal-box">
            <div class="sys-modal-title"><span>‚ö†Ô∏è</span> <span id="sys-modal-title-text">Á≥ªÁªüÊèêÁ§∫</span></div>
            <div id="sys-modal-text" class="sys-modal-text"></div>
            <button id="sys-modal-btn" class="sys-modal-btn">Á°ÆËÆ§</button>
        </div>
    </div>

    <main class="main-container">
        <div class="left-panel">
            <div class="screen-wrapper">
                <div class="screen-container">
                    <canvas id="gl-canvas" style="position:absolute; z-index:1; width:100%; height:100%;"></canvas>
                    <canvas id="oscilloscope" style="position:absolute; z-index:2; width:100%; height:100%; pointer-events:none;"></canvas>

                    <div class="osd-top">
                        <div class="flex-row items-center">
                            <span id="osd-run-state" style="background:#22c55e;color:#000;padding:0 4px;border-radius:2px;font-weight:bold;">run</span>
                            <span class="txt-y">H <span id="osd-timebase">5.0ms</span></span>
                            <span class="txt-c">A <span id="osd-samplerate">48.0kSa/s</span></span>
                        </div>
                        <div class="flex-row items-center">
                            <span style="color:#fff;">T <span id="osd-trigger-src" class="txt-y">CH1</span> <span id="osd-trigger-edge">‚Üó</span> <span id="osd-trigger-level">0.00V</span></span>
                            <span id="osd-trigger-state" class="txt-g" style="font-weight:bold;">Ëá™Âä®</span>
                        </div>
                    </div>

                    <div class="osd-side">
                        <div class="osd-box bd-y">
                            <div class="osd-title bg-y">CH1(L)</div>
                            <div class="txt-dim" style="font-size:9px;" id="osd-cpl1">DC</div>
                            <div class="txt-y" style="font-weight:bold;" id="osd-ch1-scale">0.25V</div>
                        </div>
                        <div class="osd-box bd-c">
                            <div class="osd-title bg-c">CH2(R)</div>
                            <div class="txt-dim" style="font-size:9px;" id="osd-cpl2">DC</div>
                            <div class="txt-c" style="font-weight:bold;" id="osd-ch2-scale">0.25V</div>
                        </div>
                        <div id="osd-math-box" class="osd-box" style="border-color:#9333ea; display:none;">
                            <div class="osd-title bg-p" style="color:#fff;">MATH</div>
                            <div class="txt-p" style="font-weight:bold;">C1+C2</div>
                        </div>
                    </div>

                    <div id="measure-panel" class="measure-panel">
                        <div class="txt-y">CH1 Freq: <span id="meas-ch1-freq" style="color:#fff;font-weight:bold;">-- Hz</span> | Vpp: <span id="meas-ch1-vpp" style="color:#fff;font-weight:bold;">-- V</span></div>
                        <div class="txt-c">CH2 Freq: <span id="meas-ch2-freq" style="color:#fff;font-weight:bold;">-- Hz</span> | Vpp: <span id="meas-ch2-vpp" style="color:#fff;font-weight:bold;">-- V</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="flex-row" style="flex-shrink: 0;">
                <button id="btn-measure" class="hw-btn" style="flex:1">ÊµãÈáè</button>
                <button id="btn-cursors" class="hw-btn" style="flex:1">ÂÖâÊ†á: ÂÖ≥</button>
                <button id="btn-display" class="hw-btn active" style="flex:1">Y-T Ê®°Âºè</button>
                <button id="btn-xy" class="hw-btn" style="flex:1">X-Y Ê®°Âºè</button>
            </div>
            <div class="flex-row" style="flex-shrink: 0;">
                <button id="btn-runstop" class="hw-btn btn-run" style="flex: 1.5; font-size: 13px;">ËøêË°å/ÂÅúÊ≠¢ (RUN/STOP)</button>
                <button id="btn-autoset" class="hw-btn" style="flex: 1; color: #60a5fa; border-color: #3b82f6;">Ëá™Âä®ËÆæÁΩÆ (AUTO)</button>

            </div>

            <div class="flex-row" style="gap: 4px; margin-top: 4px;">
                <button id="btn-fft-toggle" class="hw-btn" style="flex: 1; background: #6366f1;">
                    üìä È¢ëË∞±Ê®°Âºè (OFF)
                </button>
            </div>

            <div id="fft-controls" class="flex-col" style="display:none; background:#181a1f; padding:8px; border-radius:4px; border:1px solid #333; margin-top:4px;">
                <div class="flex-between txt-dim font-mono" style="font-size:9px;">
                    <span>ÈáèÁ®ã‰∏äÈôê(Hz)</span><span id="lbl-fft-max">8000Hz</span>
                </div>
                <input type="range" id="knob-fft-max" min="100" max="24000" step="100" value="8000" class="knob-slider">

                <div class="flex-between txt-dim font-mono" style="font-size:9px; margin-top:6px;">
                    <span>Â¢ûÁõä(Gain)</span><span id="lbl-fft-gain">x100</span>
                </div>
                <input type="range" id="knob-fft-gain" min="10" max="2000" step="10" value="100" class="knob-slider">
            </div>

            <div class="hw-group">
                <div class="group-title">VERTICAL (ÂûÇÁõ¥)</div>
                <div class="grid-2">
                    <div class="ch-box ch1">
                        <button id="btn-ch1" class="hw-btn active txt-y bd-y">CH1</button>
                        <div class="flex-col">
                            <div class="flex-between txt-dim font-mono" style="font-size:9px;"><span>POS</span><span id="lbl-pos1">0.00</span></div>
                            <input type="range" id="knob-pos1" min="-1" max="1" step="0.01" value="0" class="knob-slider">
                        </div>
                        <div style="display: flex; gap: 6px; align-items: flex-end;">
                            <div class="flex-col" style="flex: 1;">
                                <div class="flex-between txt-dim font-mono" style="font-size:9px;"><span>SCALE</span></div>
                                <div style="display:flex; align-items:center; background:#0a0a0c; padding:0 4px; border:1px solid #333; border-radius:2px; height: 24px;">
                                    <input type="number" id="num-scale1" value="0.25" step="0.05" min="0.001" style="flex:1; width:0; background:transparent; border:none; color:#eab308; font-family:monospace; font-size:12px; font-weight:bold; text-align:right; outline:none; padding-right: 4px;">
                                    <div style="display:flex; flex-direction:column; margin-right:4px;">
                                        <div id="btn-s1-up" style="color:#9ca3af; font-size:8px; cursor:pointer; line-height:1.2; user-select:none;">‚ñ≤</div>
                                        <div id="btn-s1-dn" style="color:#9ca3af; font-size:8px; cursor:pointer; line-height:1.2; user-select:none;">‚ñº</div>
                                    </div>
                                    <span class="txt-dim font-mono" style="font-size:9px;">V/DIV</span>
                                </div>
                            </div>
                            <div class="flex-col" style="width: 50px;">
                                <div class="txt-dim font-mono" style="font-size:9px; text-align: center;">CPL</div>
                                <select id="cpl-ch1" class="hw-select" style="padding: 2px 4px; height: 24px;">
                                    <option value="AC">AC</option>
                                    <option value="DC" selected>DC</option>
                                    <option value="GND">GND</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="ch-box ch2">
                        <button id="btn-ch2" class="hw-btn active txt-c bd-c">CH2</button>
                        <div class="flex-col">
                            <div class="flex-between txt-dim font-mono" style="font-size:9px;"><span>POS</span><span id="lbl-pos2">0.00</span></div>
                            <input type="range" id="knob-pos2" min="-1" max="1" step="0.01" value="0" class="knob-slider">
                        </div>
                        <div style="display: flex; gap: 6px; align-items: flex-end;">
                            <div class="flex-col" style="flex: 1;">
                                <div class="flex-between txt-dim font-mono" style="font-size:9px;"><span>SCALE</span></div>
                                <div style="display:flex; align-items:center; background:#0a0a0c; padding:0 4px; border:1px solid #333; border-radius:2px; height: 24px;">
                                    <input type="number" id="num-scale2" value="0.25" step="0.05" min="0.001" style="flex:1; width:0; background:transparent; border:none; color:#06b6d4; font-family:monospace; font-size:12px; font-weight:bold; text-align:right; outline:none; padding-right: 4px;">
                                    <div style="display:flex; flex-direction:column; margin-right:4px;">
                                        <div id="btn-s2-up" style="color:#9ca3af; font-size:8px; cursor:pointer; line-height:1.2; user-select:none;">‚ñ≤</div>
                                        <div id="btn-s2-dn" style="color:#9ca3af; font-size:8px; cursor:pointer; line-height:1.2; user-select:none;">‚ñº</div>
                                    </div>
                                    <span class="txt-dim font-mono" style="font-size:9px;">V/DIV</span>
                                </div>
                            </div>
                            <div class="flex-col" style="width: 50px;">
                                <div class="txt-dim font-mono" style="font-size:9px; text-align: center;">CPL</div>
                                <select id="cpl-ch2" class="hw-select" style="padding: 2px 4px; height: 24px;">
                                    <option value="AC">AC</option>
                                    <option value="DC" selected>DC</option>
                                    <option value="GND">GND</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="btn-math" class="hw-btn txt-p">MATH (CH1 + CH2)</button>

            </div>
            <div class="grid-2">
                <div class="hw-group">
                    <div class="group-title">HORIZONTAL (Ê∞¥Âπ≥)</div>
                    <div style="position:relative; width:100%; height:44px; background:#050505; border:1px solid #333; border-radius:4px; margin-top:4px; overflow:hidden;" id="minimap-container">
                        <canvas id="minimap-canvas" style="width:100%; height:100%; position:absolute; left:0; top:0;"></canvas>
                        <div id="minimap-highlight" style="position:absolute; left:0%; width:10%; height:100%; background:rgba(56, 189, 248, 0.25); border-left:1px solid #38bdf8; border-right:1px solid #38bdf8; pointer-events:none;"></div>
                        <div style="position:absolute; left:50%; top:0; width:1px; height:100%; background:transparent; border-left:1px dashed rgba(255,255,255,0.4); pointer-events:none;"></div>
                    </div>
                    <div class="flex-col" style="margin-top: 6px;">
                        <div class="flex-between txt-dim font-mono" style="font-size:9px;"><span>POS (ËßÜÂè£‰ΩçÁΩÆ)</span><span id="lbl-hpos">50.0%</span></div>
                        <input type="range" id="knob-hpos" min="0" max="100" step="0.1" value="50" class="knob-slider">
                    </div>
                    <div class="flex-col mt-1">
                        <div class="flex-between txt-dim font-mono" style="font-size:9px;"><span>SEC/DIV</span><span id="lbl-timebase">5.0ms</span></div>
                        <input type="range" id="knob-timebase" min="1" max="34" step="1" value="5" class="knob-slider" dir="rtl">
                    </div>
                </div>
                <div class="hw-group">
                    <div class="group-title">TRIGGER (Ëß¶Âèë)</div>
                    <button id="btn-trig-en" class="hw-btn" style="color:#d1d5db; margin-top: 4px; margin-bottom: 4px;">Ëß¶Âèë: ÂÖ≥</button>
                    <select id="trig-src" class="hw-select" style="margin-top: 2px;">
                        <option value="CH1">SRC: CH1</option>
                        <option value="CH2">SRC: CH2</option>
                    </select>
                    <button id="btn-edge" class="hw-btn" style="color:#fff;">ËæπÊ≤ø: ‚Üó ‰∏äÂçáÊ≤ø</button>
                    <div class="flex-col">
                        <div class="flex-between txt-dim font-mono" style="font-size:9px;"><span>LEVEL</span><span id="lbl-tlevel">0.00V</span></div>
                        <input type="range" id="knob-tlevel" min="-1" max="1" step="0.01" value="0" class="knob-slider">
                    </div>
                </div>
            </div>
            <div class="hw-group" style="margin-top: auto; border-top: 2px solid #1e3a8a;">
                <div class="group-title"><span>ËæìÂÖ•</span><span style="color:#3b82f6;">input</span></div>
                <div class="flex-col" style="background:#181a1f; padding:8px; border-radius:4px; border:1px solid #333;">
                    <div class="flex-row items-center">
                        <div class="txt-y font-mono" style="font-size:9px; font-weight:bold; width:35px;">CH1(L)</div>
                        <select id="gen-type1" class="hw-select" style="width:55px; padding:4px; font-size:9px;">
                            <option value="off">OFF</option>
                            <option value="sine">SIN</option>
                            <option value="square">SQR</option>
                            <option value="triangle">TRI</option>
                        </select>
                        <div class="flex-col" style="flex:1;">
                            <div class="flex-between txt-dim font-mono" style="font-size:9px; margin-bottom:-4px;">
                                <span>FREQ</span>
                                <div style="display:flex; align-items:center; gap:2px; background:#0a0a0c; padding:1px 4px; border:1px solid #333; border-radius:2px;">
                                    <input type="number" id="num-gen-freq1" value="1000" min="1" max="19000" style="width:40px; background:transparent; border:none; color:#eab308; font-family:monospace; font-size:10px; text-align:right; outline:none;">
                                    <span>Hz</span>
                                </div>
                            </div>
                            <input type="range" id="knob-gen-freq1" min="0" max="448" step="0.1" value="300" class="knob-slider" style="height:10px;">
                            <div class="flex-between txt-dim font-mono" style="font-size:9px; margin-top:2px; margin-bottom:-4px;">
                                <span>AMP</span>
                                <div style="display:flex; align-items:center; gap:2px; background:#0a0a0c; padding:1px 4px; border:1px solid #333; border-radius:2px;">
                                    <input type="number" id="num-gen-amp1" value="0.50" min="0" max="20" step="0.01" style="width:40px; background:transparent; border:none; color:#eab308; font-family:monospace; font-size:10px; text-align:right; outline:none;">
                                    <span>V</span>
                                </div>
                            </div>
                            <input type="range" id="knob-gen-amp1" min="0" max="20" step="0.01" value="0.5" class="knob-slider" style="height:10px;">
                        </div>
                    </div>
                    <div class="flex-row items-center mt-1" style="border-top: 1px dashed #333; padding-top: 8px;">
                        <div class="txt-c font-mono" style="font-size:9px; font-weight:bold; width:35px;">CH2(R)</div>
                        <select id="gen-type2" class="hw-select" style="width:55px; padding:4px; font-size:9px;">
                            <option value="off">OFF</option>
                            <option value="sine">SIN</option>
                            <option value="square">SQR</option>
                            <option value="triangle">TRI</option>
                        </select>
                        <div class="flex-col" style="flex:1;">
                            <div class="flex-between txt-dim font-mono" style="font-size:9px; margin-bottom:-4px;">
                                <span>FREQ</span>
                                <div style="display:flex; align-items:center; gap:2px; background:#0a0a0c; padding:1px 4px; border:1px solid #333; border-radius:2px;">
                                    <input type="number" id="num-gen-freq2" value="1000" min="1" max="19000" style="width:40px; background:transparent; border:none; color:#06b6d4; font-family:monospace; font-size:10px; text-align:right; outline:none;">
                                    <span>Hz</span>
                                </div>
                            </div>
                            <input type="range" id="knob-gen-freq2" min="0" max="448" step="0.1" value="300" class="knob-slider" style="height:10px;">
                            <div class="flex-between txt-dim font-mono" style="font-size:9px; margin-top:2px; margin-bottom:-4px;">
                                <span>AMP</span>
                                <div style="display:flex; align-items:center; gap:2px; background:#0a0a0c; padding:1px 4px; border:1px solid #333; border-radius:2px;">
                                    <input type="number" id="num-gen-amp2" value="0.50" min="0" max="20" step="0.01" style="width:40px; background:transparent; border:none; color:#06b6d4; font-family:monospace; font-size:10px; text-align:right; outline:none;">
                                    <span>V</span>
                                </div>
                            </div>
                            <input type="range" id="knob-gen-amp2" min="0" max="20" step="0.01" value="0.5" class="knob-slider" style="height:10px;">
                        </div>
                    </div>
                    <button id="btn-awg-spk" class="hw-btn txt-dim font-mono" style="font-size:10px; padding:6px; margin-top:8px;">
                        üîà Êâ¨Â£∞Âô®: ÂÖ≥
                    </button>
                </div>
                <div class="flex-row">
                    <button id="btn-mic" class="hw-btn" style="background:#2a2d35; flex: 1;">Â£∞Âç°ËæìÂÖ•</button>
                    <select id="file-select" class="hw-select" style="flex: 1.2; text-align: center; font-weight: bold; cursor: pointer; background: #2a2d35; border: 1px solid #0a0a0c;">
                        <option value="" disabled selected hidden>üìÇ Êñá‰ª∂</option>
                        <option value="LOCAL">‚Ü≥ üìÅ Êú¨Âú∞‰∏ä‰º†...</option>
                        <option value="https://wanghaohan.com/audio/oscillofun-wave.flac">üéµ oscillofun-wave.flac</option>
                        <option value="https://wanghaohan.com/audio/primer-final.flac">üéµ primer-final.flac</option>
                    </select>
                    <input type="file" id="file-input" accept="audio/*" style="display:none;" />
                </div>
                <div class="audio-control-cluster" style="position: relative; min-height: 80px;">
                    <div id="audio-loading-overlay" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(20,20,20,0.95); z-index:100; flex-direction:column; justify-content:center; align-items:center; border-radius:8px; border:1px solid #00ff88; box-sizing: border-box;">
                        <div id="audio-loading-text" style="color:#00ff88; font-family:'Courier New', monospace; margin-bottom:10px; font-size:12px; font-weight:bold; letter-spacing:1px;">Âä†ËΩΩÊï∞ÊçÆ‰∏≠...</div>
                        <div style="width:70%; height:6px; background:#111; border-radius:3px; overflow:hidden; border:1px solid #333; margin-bottom: 12px;">
                            <div id="audio-progress-bar" style="width:0%; height:100%; background:linear-gradient(90deg, #0088ff, #00ff88); box-shadow: 0 0 10px #00ff88; transition: width 0.1s;"></div>
                        </div>
                        <button id="btn-cancel-download" class="hw-btn" style="width: 80px; padding: 6px; font-size: 11px; background: #ef4444; color: #fff; border-color: #b91c1c;">ÂèñÊ∂à‰∏ãËΩΩ</button>
                    </div>
                    <audio id="audio-player" style="display:none"></audio>
                    <div class="audio-panel-row">
                        <div class="audio-time-display">
                            <span class="osd-label">TIME:</span>
                            <span id="lbl-audio-time" class="osd-value">00:00 / 00:00</span>
                        </div>
                        <input type="range" id="audio-seek-bar" class="seek-slider" min="0" max="100" step="0.01" value="0">
                    </div>
                    <div class="audio-panel-row secondary">
                        <button id="btn-audio-toggle" class="osd-btn-primary"> ‚è∏ </button>
                        <div class="speed-control-box">
                            <div class="speed-info">
                                <span class="osd-label">SPEED:</span>
                                <span id="lbl-audio-speed" class="osd-value speed">1.00x</span>
                            </div>
                            <input type="range" id="knob-audio-speed" class="speed-slider" min="0" max="100" step="0.1" value="90.9">
                        </div>
                    </div>
                </div>
                <div class="hw-group">
                    <div class="hw-group-title flex-between">
                        <span>‰∏≤Âè£ËøûÊé• SERIAL</span>
                        <span id="serial-status-dot" style="font-size: 9px; transition: all 0.3s;">‚óè DISCONNECTED</span>
                    </div>
                    <div class="hw-group-body" id="serial-control-module">
                        <div class="flex-col" style="gap: 8px;">
                            <div class="flex-row" style="gap: 4px; align-items: center;">
                                <span class="txt-dim" style="font-size: 10px; width: 30px;">BPS</span>
                                <select id="serial-baud" class="hw-select" style="flex: 1;">
                                    <option value="9600">9600</option>
                                    <option value="19200">19200</option>
                                    <option value="38400">38400</option>
                                    <option value="57600">57600</option>
                                    <option value="115200" selected>115200</option>
                                    <option value="230400">230400</option>
                                    <option value="460800">460800</option>
                                    <option value="921600">921600</option>
                                    <option value="2000000">2M (CH34x/CP2102)</option>
                                    <option value="3000000">3M (FT232R)</option>
                                    <option value="6000000">6M (CP2102N)</option>
                                    <option value="12000000">12M (FT232H ÊûÅÈôê)</option>
                                    <option value="20000000">20M (‰ªÖÈôê com0com)</option>
                                    <option value="50000000">50M (ÊµãËØïÊÄßËÉΩÊûÅÈôê)</option>
                                </select>
                            </div>

                            <div class="flex-row" style="gap: 4px; align-items: center;">
                                <span class="txt-dim" style="font-size: 10px; width: 30px;">PROT</span>
                                <select id="serial-protocol" class="hw-select" style="flex: 1;">
                                    <option value="justfloat">JustFloat (Binary)</option>
                                    <option value="firewater">FireWater (ASCII)</option>
                                    <option value="custom">Ëá™ÂÆö‰πâÂçèËÆÆ/HEX</option>
                                </select>
                            </div>

                            <div class="flex-row" style="gap: 4px; margin-top: 4px;">
                                <button id="btn-serial-open" class="hw-btn" style="flex: 1; background: #1d4ed8; color: #fff;">
                                    ‚ö° ËøûÊé•ËÆæÂ§á
                                </button>
                                <button id="btn-serial-close" class="hw-btn" style="flex: 1; display: none; background: #7f1d1d; color: #fecaca;">
                                    Êñ≠ÂºÄËøûÊé•
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script type="module" src="./js/main.js"></script>
</body>
</html>