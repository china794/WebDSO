<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WebDSO - Á∫ØÂéüÁîüÁΩëÈ°µÁ§∫Ê≥¢Âô®</title>
    <link rel="stylesheet" href="./styles/layout.css">
    <link rel="stylesheet" href="./styles/osd.css">
    <link rel="stylesheet" href="./styles/controls.css">
</head>
<body>
    <div id="sys-modal" class="sys-modal-overlay">
        <div class="sys-modal-box">
            <div class="sys-modal-title"><span>‚ö†Ô∏è</span> <span id="sys-modal-title-text">Á≥ªÁªüÊèêÁ§∫</span></div>
            <div id="sys-modal-text" class="sys-modal-text"></div>
            <button id="sys-modal-btn" class="sys-modal-btn">Á°ÆËÆ§</button>
        </div>
    </div>

    <main class="main-container">
        <div class="left-panel">
            <div class="screen-wrapper">
                <div class="screen-container">
                    <canvas id="gl-canvas" style="position:absolute; z-index:1; width:100%; height:100%;"></canvas>
                    <canvas id="oscilloscope" style="position:absolute; z-index:2; width:100%; height:100%; pointer-events:none;"></canvas>

                    <div class="osd-top">
                        <div class="flex-row items-center">
                            <span id="osd-run-state" style="background:var(--color-run);color:#fff;padding:0 4px;border-radius:2px;font-weight:bold;">run</span>
                            <span class="txt-y">H <span id="osd-timebase">5.0ms</span></span>
                            <span class="txt-c">A <span id="osd-samplerate">48.0kSa/s</span></span>
                        </div>
                        <div class="flex-row items-center">
                            <span>T <span id="osd-trigger-src" class="txt-y">CH1</span> <span id="osd-trigger-edge">‚Üó</span> <span id="osd-trigger-level">0.00V</span></span>
                            <span id="osd-trigger-state" style="background: var(--osd-text); color: var(--bg-panel); padding: 0 4px; border-radius: 2px; font-weight: bold; margin-left: 8px;">Ëá™Âä®</span>
                        </div>
                    </div>

                    <div class="osd-side">
                        <div class="osd-box bd-y">
                            <div class="osd-title bg-y">CH1(L)</div>
                            <div class="txt-dim" style="font-size:9px;" id="osd-cpl1">DC</div>
                            <div class="txt-y" style="font-weight:bold;" id="osd-ch1-scale">0.25V</div>
                        </div>
                        <div class="osd-box bd-c">
                            <div class="osd-title bg-c">CH2(R)</div>
                            <div class="txt-dim" style="font-size:9px;" id="osd-cpl2">DC</div>
                            <div class="txt-c" style="font-weight:bold;" id="osd-ch2-scale">0.25V</div>
                        </div>
                        <div id="osd-math-box" class="osd-box" style="border-color:#9333ea; display:none;">
                            <div class="osd-title bg-p" style="color:var(--osd-text);">MATH</div>
                            <div class="txt-p" style="font-weight:bold;">C1+C2</div>
                        </div>
                    </div>

                    <div id="measure-panel" class="measure-panel">
                        <div class="txt-y">CH1 Freq: <span id="meas-ch1-freq" style="color:var(--osd-text);font-weight:bold;">-- Hz</span> | Vpp: <span id="meas-ch1-vpp" style="color:var(--osd-text);font-weight:bold;">-- V</span></div>
                        <div class="txt-c">CH2 Freq: <span id="meas-ch2-freq" style="color:var(--osd-text);font-weight:bold;">-- Hz</span> | Vpp: <span id="meas-ch2-vpp" style="color:var(--osd-text);font-weight:bold;">-- V</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-panel">

            <div class="flex-between" style="margin-bottom: -4px;">
                <div class="txt-dim font-mono" style="font-weight: bold; letter-spacing: 1px;">CONTROL PANEL(ÊéßÂà∂Èù¢Êùø)</div>
                <button id="btn-theme-toggle" class="hw-btn" style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; background: var(--bg-card);">
                    <svg id="theme-icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path id="theme-icon-path" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                </button>
            </div>

            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; flex-shrink: 0;">
                <button id="btn-measure" class="hw-btn">ÊµãÈáè</button>
                <button id="btn-cursors" class="hw-btn">ÂÖâÊ†á: ÂÖ≥</button>
                <button id="btn-display" class="hw-btn active">Y-T Ê®°Âºè</button>
                <button id="btn-xy" class="hw-btn">X-Y Ê®°Âºè</button>
            </div>

            <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 12px; flex-shrink: 0;">
                <button id="btn-runstop" class="hw-btn btn-run" style="font-size: 13px;">ËøêË°å/ÂÅúÊ≠¢ (RUN/STOP)</button>
                <button id="btn-autoset" class="hw-btn" style="background: #1e3a8a; color: #93c5fd;">Ëá™Âä®ËÆæÁΩÆ (AUTO)</button>
            </div>

            <button id="btn-fft-toggle" class="hw-btn" style="background: #4f46e5; color: #fff;">üìä È¢ëË∞±Ê®°Âºè (OFF)</button>

            <div id="fft-controls" class="hw-group" style="display:none; margin-top: -10px;">
                <div class="flex-between txt-dim font-mono" style="font-size:10px;">
                    <span>XËΩ¥ÂàªÂ∫¶ (X-Axis)</span>
                    <button id="btn-fft-scale" class="hw-btn" style="width: auto; padding: 4px 12px; font-size: 10px;">Á∫øÊÄß (Linear)</button>
                </div>
                <div class="flex-col">
                    <div class="flex-between txt-dim font-mono" style="font-size:10px;">
                        <span>ÈáèÁ®ã‰∏äÈôê(Hz)</span><span id="lbl-fft-max">8000Hz</span>
                    </div>
                    <input type="range" id="knob-fft-max" min="100" max="24000" step="100" value="8000">
                </div>
                <div class="flex-col">
                    <div class="flex-between txt-dim font-mono" style="font-size:10px;">
                        <span>Â¢ûÁõä(Gain)</span><span id="lbl-fft-gain">x100</span>
                    </div>
                    <input type="range" id="knob-fft-gain" min="10" max="4000" step="10" value="100">
                </div>
            </div>

            <div class="hw-group">
                <div class="group-title">VERTICAL (ÂûÇÁõ¥)</div>
                <div class="grid-2">
                    <div class="ch-box ch1">
                        <button id="btn-ch1" class="hw-btn active txt-y">CH1</button>

                        <div class="flex-col">
                            <div class="flex-between txt-dim font-mono" style="font-size:10px;"><span>POS</span><span id="lbl-pos1">0.00</span></div>
                            <input type="range" id="knob-pos1" min="-1" max="1" step="0.01" value="0">
                        </div>

                        <div class="flex-col">
                            <div class="flex-between txt-dim font-mono" style="font-size:10px;"><span>SCALE</span></div>
                            <div class="flat-input-box">
                                <input type="number" id="num-scale1" value="0.25" step="0.05" min="0.001" class="txt-y">
                                <div class="spin-btns">
                                    <div id="btn-s1-up">‚ñ≤</div>
                                    <div id="btn-s1-dn">‚ñº</div>
                                </div>
                                <span class="txt-dim font-mono" style="font-size:10px; margin-left: 4px;">V</span>
                            </div>
                        </div>

                        <div class="flex-col">
                            <div class="flex-between txt-dim font-mono" style="font-size:10px;"><span>CPL (ËÄ¶Âêà)</span></div>
                            <select id="cpl-ch1" class="hw-select" style="height: 28px; padding: 2px 8px;">
                                <option value="AC">AC</option>
                                <option value="DC" selected>DC</option>
                                <option value="GND">GND</option>
                            </select>
                        </div>
                    </div>

                    <div class="ch-box ch2">
                        <button id="btn-ch2" class="hw-btn active txt-c">CH2</button>

                        <div class="flex-col">
                            <div class="flex-between txt-dim font-mono" style="font-size:10px;"><span>POS</span><span id="lbl-pos2">0.00</span></div>
                            <input type="range" id="knob-pos2" min="-1" max="1" step="0.01" value="0">
                        </div>

                        <div class="flex-col">
                            <div class="flex-between txt-dim font-mono" style="font-size:10px;"><span>SCALE</span></div>
                            <div class="flat-input-box">
                                <input type="number" id="num-scale2" value="0.25" step="0.05" min="0.001" class="txt-c">
                                <div class="spin-btns">
                                    <div id="btn-s2-up">‚ñ≤</div>
                                    <div id="btn-s2-dn">‚ñº</div>
                                </div>
                                <span class="txt-dim font-mono" style="font-size:10px; margin-left: 4px;">V</span>
                            </div>
                        </div>

                        <div class="flex-col">
                            <div class="flex-between txt-dim font-mono" style="font-size:10px;"><span>CPL (ËÄ¶Âêà)</span></div>
                            <select id="cpl-ch2" class="hw-select" style="height: 28px; padding: 2px 8px;">
                                <option value="AC">AC</option>
                                <option value="DC" selected>DC</option>
                                <option value="GND">GND</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button id="btn-math" class="hw-btn" style="color: var(--math-color);">MATH (CH1 + CH2)</button>
            </div>

            <div class="grid-2">
                <div class="hw-group">
                    <div class="group-title">HORIZONTAL (Ê∞¥Âπ≥)</div>
                    <div style="position:relative; width:100%; height:44px; background:#050505; border-radius:4px; overflow:hidden;" id="minimap-container">
                        <canvas id="minimap-canvas" style="width:100%; height:100%; position:absolute; left:0; top:0;"></canvas>
                        <div id="minimap-highlight" style="position:absolute; left:0%; width:10%; height:100%; background:rgba(56, 189, 248, 0.25); border-left:1px solid #38bdf8; border-right:1px solid #38bdf8; pointer-events:none;"></div>
                        <div style="position:absolute; left:50%; top:0; width:1px; height:100%; border-left:1px dashed rgba(255,255,255,0.4); pointer-events:none;"></div>
                    </div>
                    <div class="flex-col">
                        <div class="flex-between txt-dim font-mono" style="font-size:10px;"><span>POS (‰ΩçÁΩÆ)</span><span id="lbl-hpos">50.0%</span></div>
                        <input type="range" id="knob-hpos" min="0" max="100" step="0.1" value="50">
                    </div>
                    <div class="flex-col">
                        <div class="flex-between txt-dim font-mono" style="font-size:10px;"><span>SEC/DIV</span><span id="lbl-timebase">5.0ms</span></div>
                        <input type="range" id="knob-timebase" min="1" max="34" step="1" value="5" dir="rtl">
                    </div>
                </div>
                <div class="hw-group">
                    <div class="group-title">TRIGGER (Ëß¶Âèë)</div>
                    <button id="btn-trig-en" class="hw-btn">Ëß¶Âèë: ÂÖ≥</button>
                    <select id="trig-src" class="hw-select">
                        <option value="CH1">SRC: CH1</option>
                        <option value="CH2">SRC: CH2</option>
                    </select>
                    <button id="btn-edge" class="hw-btn">ËæπÊ≤ø: ‚Üó ‰∏äÂçáÊ≤ø</button>
                    <div class="flex-col" style="margin-top: auto;">
                        <div class="flex-between txt-dim font-mono" style="font-size:10px;"><span>LEVEL</span><span id="lbl-tlevel">0.00V</span></div>
                        <input type="range" id="knob-tlevel" min="-1" max="1" step="0.01" value="0">
                    </div>
                </div>
            </div>

            <div class="hw-group" style="border-top: 3px solid #1e3a8a; border-radius: 0 0 var(--radius-md) var(--radius-md);">
                <div class="group-title"><span>INPUT(ËæìÂÖ•)</span><span style="color:#3b82f6; font-size: 10px;">SIGNAL GEN</span></div>

                <div class="ch-box" style="padding: 16px; gap: 16px;">
                    <div class="flex-row items-start" style="gap:16px; border-bottom: 1px dashed var(--border-color); padding-bottom: 16px;">
                        <div class="flex-col" style="width: 75px; gap: 8px;">
                            <div class="txt-y font-mono" style="font-size:12px; font-weight:bold;">CH1(L)</div>
                            <select id="gen-type1" class="hw-select" style="padding: 6px;">
                                <option value="off">OFF</option>
                                <option value="sine">SIN</option>
                                <option value="square">SQR</option>
                                <option value="triangle">TRI</option>
                            </select>
                        </div>
                        <div class="flex-col" style="flex:1; gap: 12px;">
                            <div class="flex-col" style="gap: 6px;">
                                <div class="flex-between txt-dim font-mono" style="font-size:10px;">
                                    <span>FREQ</span>
                                    <div class="flat-input-box" style="height:24px; width:80px;">
                                        <input type="number" id="num-gen-freq1" value="1000" min="1" max="19000" class="txt-y">
                                        <span class="txt-dim" style="margin-left:4px;">Hz</span>
                                    </div>
                                </div>
                                <input type="range" id="knob-gen-freq1" min="0" max="448" step="0.1" value="300">
                            </div>
                            <div class="flex-col" style="gap: 6px;">
                                <div class="flex-between txt-dim font-mono" style="font-size:10px;">
                                    <span>AMP</span>
                                    <div class="flat-input-box" style="height:24px; width:80px;">
                                        <input type="number" id="num-gen-amp1" value="0.50" min="0" max="20" step="0.01" class="txt-y">
                                        <span class="txt-dim" style="margin-left:4px;">V</span>
                                    </div>
                                </div>
                                <input type="range" id="knob-gen-amp1" min="0" max="20" step="0.01" value="0.5">
                            </div>
                        </div>
                    </div>

                    <div class="flex-row items-start" style="gap:16px;">
                        <div class="flex-col" style="width: 75px; gap: 8px;">
                            <div class="txt-c font-mono" style="font-size:12px; font-weight:bold;">CH2(R)</div>
                            <select id="gen-type2" class="hw-select" style="padding: 6px;">
                                <option value="off">OFF</option>
                                <option value="sine">SIN</option>
                                <option value="square">SQR</option>
                                <option value="triangle">TRI</option>
                            </select>
                        </div>
                        <div class="flex-col" style="flex:1; gap: 12px;">
                            <div class="flex-col" style="gap: 6px;">
                                <div class="flex-between txt-dim font-mono" style="font-size:10px;">
                                    <span>FREQ</span>
                                    <div class="flat-input-box" style="height:24px; width:80px;">
                                        <input type="number" id="num-gen-freq2" value="1000" min="1" max="19000" class="txt-c">
                                        <span class="txt-dim" style="margin-left:4px;">Hz</span>
                                    </div>
                                </div>
                                <input type="range" id="knob-gen-freq2" min="0" max="448" step="0.1" value="300">
                            </div>
                            <div class="flex-col" style="gap: 6px;">
                                <div class="flex-between txt-dim font-mono" style="font-size:10px;">
                                    <span>AMP</span>
                                    <div class="flat-input-box" style="height:24px; width:80px;">
                                        <input type="number" id="num-gen-amp2" value="0.50" min="0" max="20" step="0.01" class="txt-c">
                                        <span class="txt-dim" style="margin-left:4px;">V</span>
                                    </div>
                                </div>
                                <input type="range" id="knob-gen-amp2" min="0" max="20" step="0.01" value="0.5">
                            </div>
                        </div>
                    </div>
                    <button id="btn-awg-spk" class="hw-btn font-mono" style="color: var(--text-dim);">üîà Êâ¨Â£∞Âô®: ÂÖ≥</button>
                </div>

                

                

                <div class="audio-control-cluster" style="position: relative; min-height: 80px;">
                    <div class="flex-row" style="margin-top: 8px;">
                        <button id="btn-mic" class="hw-btn" style="flex: 1;">Â£∞Âç°ËæìÂÖ•</button>
                        <select id="file-select" class="hw-select" style="flex: 1.2; text-align: center; font-weight: bold;">
                            <option value="" disabled selected hidden>üìÇ Á§∫Ê≥¢Âô®Èü≥‰πê</option>
                            <option value="LOCAL">‚Ü≥ üìÅ Êú¨Âú∞‰∏ä‰º†...</option>
                            <option value="https://wanghaohan.com/audio/oscillofun-wave.flac">üéµ oscillofun-wave</option>
                            <option value="https://wanghaohan.com/audio/primer-final.flac">üéµ primer-final</option>
                        </select>
                        <input type="file" id="file-input" accept="audio/*" style="display:none;" />
                    </div>
                    <div id="audio-loading-overlay" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(18,18,20,0.95); z-index:100; flex-direction:column; justify-content:center; align-items:center; border-radius:8px;">
                        <div id="audio-loading-text" style="color:#00ff88; font-family:'Courier New', monospace; margin-bottom:10px; font-size:12px; font-weight:bold; letter-spacing:1px;">Âä†ËΩΩÊï∞ÊçÆ‰∏≠...</div>
                        <div style="width:70%; height:6px; background:#111; border-radius:3px; overflow:hidden; border:1px solid #333; margin-bottom: 12px;">
                            <div id="audio-progress-bar" style="width:0%; height:100%; background:#00ff88; transition: width 0.1s;"></div>
                        </div>
                        <button id="btn-cancel-download" class="hw-btn" style="width: 80px; padding: 6px; font-size: 11px; background: #dc2626; color: #fff;">ÂèñÊ∂à‰∏ãËΩΩ</button>
                    </div>
                    <audio id="audio-player" style="display:none"></audio>
                    <div class="audio-panel-row">
                        <div class="flex-between">
                            <span class="osd-label">TIME</span>
                            <span id="lbl-audio-time" class="osd-value">00:00 / 00:00</span>
                        </div>
                        <input type="range" id="audio-seek-bar" min="0" max="100" step="0.01" value="0">
                    </div>
                    <div class="audio-panel-row secondary">
                        <button id="btn-audio-toggle" class="osd-btn-primary"> ‚è∏ </button>
                        <div class="speed-control-box">
                            <span class="osd-label">SPEED</span>
                            <input type="range" id="knob-audio-speed" min="0" max="100" step="0.1" value="90.9">
                            <span id="lbl-audio-speed" class="osd-value speed" style="width: 45px; text-align: right;">1.00x</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="hw-group">
                <div class="group-title">
                    <span>‰∏≤Âè£ËøûÊé• SERIAL</span>
                    <span id="serial-status-dot" style="font-size: 10px; text-transform: none;">‚óè DISCONNECTED</span>
                </div>
                <div class="ch-box" id="serial-control-module" style="gap: 12px; padding: 16px;">
                    <div class="flex-row items-center">
                        <span class="txt-dim font-mono" style="font-size: 11px; width: 40px;">BPS</span>
                        <select id="serial-baud" class="hw-select">
                            <option value="9600">9600</option>
                            <option value="19200">19200</option>
                            <option value="38400">38400</option>
                            <option value="57600">57600</option>
                            <option value="115200" selected>115200</option>
                            <option value="230400">230400</option>
                            <option value="460800">460800</option>
                            <option value="921600">921600</option>
                            <option value="2000000">2M (CH34x/CP2102)</option>
                            <option value="3000000">3M (FT232R)</option>
                            <option value="6000000">6M (CP2102N)</option>
                            <option value="12000000">12M (FT232H ÊûÅÈôê)</option>
                            <option value="20000000">20M (‰ªÖÈôê com0com)</option>
                            <option value="50000000">50M (ÊµãËØïÊÄßËÉΩÊûÅÈôê)</option>
                        </select>
                    </div>
                    <div class="flex-row items-center">
                        <span class="txt-dim font-mono" style="font-size: 11px; width: 40px;">PROT</span>
                        <select id="serial-protocol" class="hw-select">
                            <option value="justfloat">JustFloat (Binary)</option>
                            <option value="firewater">FireWater (ASCII)</option>
                            <option value="custom">Ëá™ÂÆö‰πâÂçèËÆÆ/HEX</option>
                        </select>
                    </div>
                    <div class="flex-row" style="gap: 8px; margin-top: 4px;">
                        <button id="btn-serial-open" class="hw-btn" style="flex: 1; background: #2563eb; color: #fff;">ËøûÊé•‰∏≤Âè£</button>
                        <button id="btn-serial-close" class="hw-btn" style="flex: 1; display: none; background: #dc2626; color: #fff;">Êñ≠ÂºÄ</button>
                        <button id="btn-serial-spk" class="hw-btn" style="flex: 1;">üîà ÁõëÂê¨</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script type="module" src="./js/main.js"></script>
</body>
</html>